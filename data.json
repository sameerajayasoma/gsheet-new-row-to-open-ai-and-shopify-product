{"id":65,"name":"Trigger","displayName":"Google Sheets","documentation":"","moduleName":"trigger.google.sheets","serviceTypes":[{"name":"SheetRowService","description":"Triggers when a new event related to Google Sheet is received.\nAvailable actions: onAppendRow, and onUpdateRow\n","functions":[{"isRemote":true,"documentation":"","name":"onAppendRow","parameters":[{"name":"payload","typeName":"record","optional":false,"typeInfo":{"name":"GSheetEvent","orgName":"ballerinax","moduleName":"trigger.google.sheets","version":"0.8.1"},"displayAnnotation":{},"hasRestType":true,"defaultable":false,"fields":[{"name":"spreadsheetId","typeName":"string","optional":true,"defaultable":false},{"name":"spreadsheetName","typeName":"string","optional":true,"defaultable":false},{"name":"worksheetId","typeName":"int","optional":true,"defaultable":false},{"name":"worksheetName","typeName":"string","optional":true,"defaultable":false},{"name":"rangeUpdated","typeName":"string","optional":true,"defaultable":false},{"name":"startingRowPosition","typeName":"int","optional":true,"defaultable":false},{"name":"endRowPosition","typeName":"int","optional":true,"defaultable":false},{"name":"startingColumnPosition","typeName":"int","optional":true,"defaultable":false},{"name":"endColumnPosition","typeName":"int","optional":true,"defaultable":false},{"memberType":{"memberType":{"members":[{"typeName":"int","optional":false,"defaultable":false},{"typeName":"string","optional":false,"defaultable":false},{"typeName":"float","optional":false,"defaultable":false}],"typeName":"union","optional":false,"defaultable":false},"typeName":"array","optional":false,"defaultable":false},"name":"newValues","typeName":"array","optional":true,"defaultable":false},{"name":"lastRowWithContent","typeName":"int","optional":true,"defaultable":false},{"name":"lastColumnWithContent","typeName":"int","optional":true,"defaultable":false},{"name":"eventType","typeName":"string","optional":true,"defaultable":false},{"name":"eventData","typeName":"json","optional":true,"defaultable":false}],"restType":{"typeName":"anydata","optional":false,"defaultable":false}}],"returnType":{"typeName":"error","optional":true,"displayAnnotation":{},"defaultable":false},"displayAnnotation":{}},{"isRemote":true,"documentation":"","name":"onUpdateRow","parameters":[{"name":"payload","typeName":"record","optional":false,"typeInfo":{"name":"GSheetEvent","orgName":"ballerinax","moduleName":"trigger.google.sheets","version":"0.8.1"},"displayAnnotation":{},"hasRestType":true,"defaultable":false,"fields":[{"name":"spreadsheetId","typeName":"string","optional":true,"defaultable":false},{"name":"spreadsheetName","typeName":"string","optional":true,"defaultable":false},{"name":"worksheetId","typeName":"int","optional":true,"defaultable":false},{"name":"worksheetName","typeName":"string","optional":true,"defaultable":false},{"name":"rangeUpdated","typeName":"string","optional":true,"defaultable":false},{"name":"startingRowPosition","typeName":"int","optional":true,"defaultable":false},{"name":"endRowPosition","typeName":"int","optional":true,"defaultable":false},{"name":"startingColumnPosition","typeName":"int","optional":true,"defaultable":false},{"name":"endColumnPosition","typeName":"int","optional":true,"defaultable":false},{"memberType":{"memberType":{"members":[{"typeName":"int","optional":false,"defaultable":false},{"typeName":"string","optional":false,"defaultable":false},{"typeName":"float","optional":false,"defaultable":false}],"typeName":"union","optional":false,"defaultable":false},"typeName":"array","optional":false,"defaultable":false},"name":"newValues","typeName":"array","optional":true,"defaultable":false},{"name":"lastRowWithContent","typeName":"int","optional":true,"defaultable":false},{"name":"lastColumnWithContent","typeName":"int","optional":true,"defaultable":false},{"name":"eventType","typeName":"string","optional":true,"defaultable":false},{"name":"eventData","typeName":"json","optional":true,"defaultable":false}],"restType":{"typeName":"anydata","optional":false,"defaultable":false}}],"returnType":{"typeName":"error","optional":true,"displayAnnotation":{},"defaultable":false},"displayAnnotation":{}}],"displayAnnotation":{}}],"listenerParams":[{"name":"listenerConfig","typeName":"record","optional":false,"typeInfo":{"name":"ListenerConfig","orgName":"ballerinax","moduleName":"trigger.google.sheets","version":"0.8.1"},"displayAnnotation":{},"hasRestType":true,"defaultable":false,"fields":[{"name":"spreadsheetId","typeName":"string","optional":false,"defaultable":false}],"restType":{"typeName":"anydata","optional":false,"defaultable":false}},{"name":"listenOn","typeName":"union","optional":false,"defaultValue":"8090","displayAnnotation":{},"defaultable":true,"members":[{"typeName":"int","optional":false,"defaultable":false},{"fields":[],"name":"Listener","typeName":"object","optional":false,"typeInfo":{"name":"Listener","orgName":"ballerina","moduleName":"http","version":"2.4.5"},"defaultable":false}]}],"listenerProtocol":"http","displayAnnotation":{"label":"Google Sheets","iconPath":"docs/icon.png"},"package":{"organization":"ballerinax","name":"trigger.google.sheets","version":"0.8.1","platform":"any","languageSpecificationVersion":"2022R3","isDeprecated":false,"deprecateMessage":"","URL":"/ballerinax/trigger.google.sheets/0.8.1","balaVersion":"2.0.0","balaURL":"https://fileserver.central.ballerina.io/2.0/ballerinax/trigger.google.sheets/0.8.1/ballerinax-trigger.google.sheets-any-0.8.1.bala?md5=6Q8Gpe7q7BrWUenks9Aw_Q&expires=1679950489","digest":"sha-256=4a0b492f071dc9595e1bc3097f8f924b3f4ad14c54adba19bb123975e1530e16","summary":"Listen to [Google Sheet Events](https://developers.google.com/apps-script/guides/sheets) from Ballerina","readme":"Listen to [Google Sheet Events](https://developers.google.com/apps-script/guides/sheets) from Ballerina\n\n## Package overview\nThe `ballerinax/trigger.google.sheets` is a [Ballerina](https://ballerina.io/) trigger for Google Sheets.\nThis package provides the capability to access Google App script for Google Sheets.\n\n### Compatibility\n|                               | Version                        |\n|-------------------------------|--------------------------------|\n| Ballerina Language            | Ballerina Swan Lake 2201.0.1   |\n\n## Report issues\nTo report bugs, request new features, start new discussions, view project boards, etc., go to the [Ballerina Extended Library repository](https://github.com/ballerina-platform/ballerina-extended-library)\n\n## Useful links\n- Discuss code changes of the Ballerina project in [ballerina-dev@googlegroups.com](mailto:ballerina-dev@googlegroups.com).\n- Chat live with us via our [Slack channel](https://ballerina.io/community/slack/).\n- Post all technical questions on Stack Overflow with the [#ballerina](https://stackoverflow.com/questions/tagged/ballerina) tag","template":false,"licenses":["Apache-2.0"],"authors":["Ballerina"],"sourceCodeLocation":"https://github.com/ballerina-platform/asyncapi-triggers","keywords":["Communication/Team Chat","Cost/Freemium","Trigger"],"ballerinaVersion":"2201.2.3","icon":"https://bcentral-packageicons.azureedge.net/images/ballerinax_trigger.google.sheets_0.8.1.png","ownerUUID":"9712bf21-e852-48ba-83f0-2c7c5262cb6d","createdDate":1669720848000,"pullCount":118,"visibility":"public","modules":[{"packageURL":"/ballerinax/trigger.google.sheets/0.8.1","apiDocURL":"https://lib.ballerina.io/ballerinax/trigger.google.sheets/0.8.1","name":"trigger.google.sheets","summary":"","readme":"## Overview\n\nThe [Ballerina](https://ballerina.io/) listener for Google Sheets provides the capability to listen to simple events using the [App Scripts triggers](https://developers.google.com/apps-script/guides/triggers). App Scripts runs a function automatically whenever a certain event occurs, for example, when a user changes a value in a spreadsheet. When an event is triggered, Apps Script passes the event object ( typically `e`) as an argument to the function. The event object contains information about the context that caused the event to trigger. Using App Script [Installable triggers](https://developers.google.com/apps-script/guides/triggers/installable) we can invoke services that require authorization and pass the event information. The Google Sheets Ballerina listener can listen to these events triggered and execute the user logic based on the event type received.\n\nThe trigger can listen to events triggered  when a spreadsheet is edited such as when a row is appended to a spreadsheet or when a row is updated in a spreadsheet with the following trigger methods: \n* `onAppendRow`\n* `onUpdateRow`\n\nThis module supports [Google App Scripts](https://developers.google.com/apps-script/guides/triggers).\n\n## Prerequisites\n\nBefore using this connector in your Ballerina application, complete the following:\n\n- Create [Google account](https://accounts.google.com/signup/v2/webcreateaccount?utm_source=ga-ob-search&utm_medium=google-account&flowName=GlifWebSignIn&flowEntry=SignUp)\n- Enable Google App Script trigger to listen to internal changes of a spreadsheet.\n\n    1. Open the google sheet.\n    2. Navigate to `Extensions > Apps Script`.\n    3. Name your project. (Example: Name the project `GSheet_Ballerina_Trigger`)\n    4. Remove all the code that is currently in the Code.gs file, and replace it with this:\n        ```\n        function atChange(e){\n            if (e.changeType == \"REMOVE_ROW\") {\n                saveDeleteStatus(1);\n            }\n        }\n\n        function atEdit(e){\n            var source = e.source;\n            var range = e.range;\n\n            var a = range.getRow();\n            var b = range.getSheet().getLastRow();\n            var previousLastRow = Number(getValue());\n            var deleteStatus = Number(getDeleteStatus());\n            var eventType = \"edit\";\n\n            if ((a == b && b != previousLastRow) || (a == b && b == previousLastRow && deleteStatus == 1)) {\n                eventType = \"appendRow\";\n            }\n            else if ((a != b) || (a == b && b == previousLastRow && deleteStatus == 0)) {\n                eventType = \"updateRow\";\n            }\n            \n            var formData = {\n                    'spreadsheetId' : source.getId(),\n                    'spreadsheetName' : source.getName(),\n                    'worksheetId' : range.getSheet().getSheetId(),\n                    'worksheetName' : range.getSheet().getName(),\n                    'rangeUpdated' : range.getA1Notation(),\n                    'startingRowPosition' : range.getRow(),\n                    'startingColumnPosition' : range.getColumn(),\n                    'endRowPosition' : range.getLastRow(),\n                    'endColumnPosition' : range.getLastColumn(),\n                    'newValues' : range.getValues(),\n                    'lastRowWithContent' : range.getSheet().getLastRow(),\n                    'lastColumnWithContent' : range.getSheet().getLastColumn(),\n                    'previousLastRow' : previousLastRow,\n                    'eventType' : eventType,\n                    'eventData' : e\n            };\n            var payload = JSON.stringify(formData);\n\n            var options = {\n                'method' : 'post',\n                'contentType': 'application/json',\n                'payload' : payload\n            };\n\n            UrlFetchApp.fetch('<BASE_URL>/', options);\n\n            saveValue(range.getSheet().getLastRow());\n            saveDeleteStatus(0);\n        }\n\n        var properties = PropertiesService.getScriptProperties();\n\n        function saveValue(lastRow) {\n            properties.setProperty('PREVIOUS_LAST_ROW', lastRow);\n        }\n\n        function getValue() {\n            return properties.getProperty('PREVIOUS_LAST_ROW');\n        }\n\n        function saveDeleteStatus(deleteStatus) {\n            properties.setProperty('DELETE_STATUS', deleteStatus);\n        }\n\n        function getDeleteStatus() {\n            return properties.getProperty('DELETE_STATUS');\n        }\n        ```\n        We’re using the UrlFetchApp class to communicate with other applications on the internet.\n\n    5. Replace the <BASE_URL> section with the base URL where your listener service is running. (Note: You can use [ngrok](https://ngrok.com/docs) to expose your web server to the internet. Example: 'https://7745640c2478.ngrok.io/')\n    6. Navigate to the `Triggers` section in the left menu of the editor.\n    7. Click `Add Trigger` button.\n    8. Select the following values for the following fields.\n\n        | Field                        | Value             |\n        |------------------------------|-------------------|\n        | Choose which function to run | `atChange`        |\n        | Select event source          | `From spreadsheet`|\n        | Select event type            | `On change`       |\n\n    9. This will prompt you to authorize your script to connect to an external service. Click `Review Permissions` and then `Allow` to continue.\n    10. Repeat the same process, add a new trigger with the following values for the following fields. Then click Save!.\n\n        | Field                        | Value             |\n        |------------------------------|-------------------|\n        | Choose which function to run | `atEdit`          |\n        | Select event source          | `From spreadsheet`|\n        | Select event type            | `On edit`         |\n    11. You have now configured your triggers. You can test these triggers by editing the Google sheet.\n\n## Quickstart\nTo use the Google Sheets listener in your Ballerina application, update the .bal file as follows:\n\n### Step 1: Import listener\nImport the ballerinax/trigger.google.sheets module into the Ballerina project.\n```ballerina\n    import ballerinax/trigger.google.sheets;\n```\n\n### Step 2: Create a new listener instance\nCreate a `sheets:ListenerConfig` with the spreadsheet ID obtained, and initialize the listener with it. \n```ballerina\n    configurable sheets:ListenerConfig userInput = {\n        spreadsheetId: \"1rqmQttRXGYSYJheibCpVCYXBa4jmggrEXpcgH2ahk94\"\n    };\n\n    listener sheets:Listener sheetListener = new (userInput);\n```\n**!!! NOTE:** Spreadsheet ID is available in the spreadsheet URL \"https://docs.google.com/spreadsheets/d/\" + <SPREADSHEET_ID> + \"/edit#gid=\" + <WORKSHEET_ID>\n\n### Step 3: Invoke listener triggers\n1. Now you can use the triggers available within the listener. \n\n    Following is an example on how to listen to append events and update events of a spreadsheet using the listener. \n    Add the trigger implementation logic under each section based on the event type you want to listen to using the Google sheets Listener.\n\n    Listen to append events and update events\n\n    ```ballerina\n    service sheets:SheetRowService on sheetListener {\n\n        remote function onAppendRow(sheets:GSheetEvent payload) returns error? {\n            json? eventData = payload?.eventData;\n            // Write your logic here.....\n        }\n\n        remote function onUpdateRow(sheets:GSheetEvent payload) returns error? {\n            json? eventData = payload?.eventData;\n            // Write your logic here.....\n        }\n    }\n    ```\n\n    **!!! NOTE:** The Google Sheets Trigger can listen to events triggered when a spreadsheet is edited such as when a new row is appended or when a row is updated with the following trigger methods: `onAppendRow`, `onUpdateRow`. We can get more information about the edit event such as the `spreadsheet ID, spreadsheet name, worksheet ID, worksheet name, range updated, starting row position, end row position, starting column position, end column position, new values, last row with content, last column with content` etc.\n\n2. Use `bal run` command to compile and run the Ballerina program. "}]},"triggerType":"sheets","httpBased":true}